Quest: nobleandnecromancer
DisplayName: The Noble and the Necromancer
-- Message panels
QRC:

QuestComplete:  [1004]
<ce>            Alone and confronted by two dangerous forces,
<ce>                the noble has no choice but to assent.
<ce>              He pulls out four large sacks of money and
<ce>         puts two at your feet, and two at the necromancer's.
<ce>         The robed magician hefts them both in his hands and
<ce>     tells you, "He'll let you out of here. If he threatens you,
<ce>                  he will suffer the consequences."
<ce>       Then with a quick Recall spell, he disappears from view.
<ce>
<ce>           _noble_'s eyes burn. "Take your money and leave,
<ce>          filthy scoundrel! And if you tell anyone a word of
<ce>                        what has happened..."
<ce>
<ce>             He leans into your face and points a finger.
<ce>
<ce>                        "I. WILL. KILL. YOU."
<ce>
<ce>         He then storms away, letting you collect the money.

RumorsPostFailure:  [1006]
_noble_'s a seer! He can predict when a town's gonna get attacked! 
<ce>
They say _noble_ makes deals with the underworld.

RumorsPostSuccess:   [1007]
_noble_'s a seer! He can predict when a town's gonna get attacked! 
<ce>
They say _noble_ makes deals with the underworld.

Message:  1011
<ce>             A hooded courier awkwardly puts a parchment
<ce>            into your pack, avoiding eye contact with you,
<ce>                       and then saunters away.

Message:  1012
Greetings.
<ce>
  If you are reading this, my courier has judged you worthy
of helping me with a sensitive matter. I can promise you fame
beyond your imagination across ____palace_ if you will
follow my plans faithfully. Find me at _palace_
in __palace_ within the next =timer_ days,
or this offer is rescinded. Look for me inside
and tell me of this letter.
<ce>
                           _noble_

Message:  1013
<ce>           You tell _noble_ that you have come in response
<ce>      to his letter. He puts aside other business and faces you.
<ce>
<ce>            "A taker. Good. We can benefit mutually if you
<ce>              follow my orders and tell no one.
<ce>            I need you to find a necromancer I've learned
<ce>        is practicing the dark arts in %crn and make an offer.
<ce>          Go to ___dung_ and tell him I need him to raise an
<ce>           undead army in ___town_ that I will crush. He will
<ce>             be rewarded with 2,500 gold pieces. Go now."
<ce>
<ce>                       Do you accept this task?

Message:  1014
<ce>                    You write down _noble_'s task
<ce>                       and tell him you accept.

Message:  1015
%qdt:
 _noble_ of ___palace_
 has sent me to speak to
 a necromancer residing
 in ___dung_ about a plot
 to raise an army, in exchange
 for 2,500 gold. _noble_ needs
 the undead to appear in ___town_.

Message:  1016
<ce>                       _noble_ raises an eyebrow.
<ce>
<ce>              "Really? You refuse? Keep your mouth shut.
<ce>                 I have more power than you expect."
<ce>
<ce>                He then shoos you away with his hand.

Message:  1017
<ce>          On your way out of the palace, you hear an uproar.
<ce>           _noble_ has called for the guards to arrest you,
<ce>          probably as a warning against speaking about his plot.
<ce>               You'll need to find some place to hide.

Message:  1018
<ce>             The necromancer coldly awaits your message.
<ce>          You detail _noble_'s plan and the expected reward.
<ce>
<ce>           "Hmm. 2,500 is a bit low. A shame. But this year
<ce>             has not been kind to me. Tell him I accept.
<ce>           He must send some trigger to ___town_, and that
<ce>                 night I will cause the uprising.
<ce>                Once he has defeated my forces, I will
<ce>            visit him in ___palace_ and collect my reward.
<ce>                My eyes and ears under the earth will
<ce>                          follow you, %ra."

Message:  1019
%qdt:
 The necromancer has agreed. I should
 inform _noble_ and see what else
 I must do to claim my reward.

Message:  1020
<ce>               Good. I'll send some forces to ___town_
<ce>                  and start running the rumor mill.
<ce>            They'll call me an imbecile until they see the
<ce>               dead rising from the ground. You are the
<ce>            trigger I will send to the city. Arrive there
<ce>       expeditiously and wait for night. Help defeat the undead
<ce>               and return to me to discuss your reward.

Message:  1021
%qdt:
 _noble_ apparently needs me to be
 present for the undead to attack
 ___town_. When I arrive there,
 I must wait outdoors until night. The undead
 will rise then, and when they
 are defeated, I can return to
 ___palace_ for my reward.

Message:  1022
<ce>         This is ___town_, but nothing is happening here yet.
<ce>                 You'll have to wait until nighttime.

Message:  1023
<ce>             You see some knights pace around nervously.
<ce>          You can't tell how much they know about the plot,
<ce>                 but they're ready for combat.
<ce>
<ce>               Then a rumbling begins under the ground.
<ce>               You hear sparse screams from other parts
<ce>                of ___town_, which start to multiply.
<ce>             Soon bodies rise up from the earth and start
<ce>                     to attack anything in sight.

Message:  1024
<ce>        The knights win back the battle as the night rages on.
<ce>                   Soon the undead are routed.  
<ce>
<ce>        "By %god, _noble_ was right! This town would have been
<ce>           ruined if not for his counsel! A genius, he is!"
<ce>
<ce>        The soldiers cheer and raise their weapons in the air.
<ce>           If anyone knows about the machinations at work,
<ce>              they're hiding it very well.  As for you,
<ce>             it's time to claim your reward from _noble_.

Message:  1025
<ce>           At the sight of you, _noble_ sends everyone else
<ce>               out from the palace to speak privately.
<ce>                      Before he opens his mouth,
<ce>         the icy presence of the necromancer fills the room.
<ce>                   _noble_'s eyes widen with fear.
<ce>             The hooded figure then speaks the first word.
<ce>
<ce>       "I am here to claim 10,000 gold for my work. Should you
<ce>         fail to deliver it to me, I will raise another army
<ce>          in another city, and ensure your plot is revealed.
<ce>                         You have no choice."
<ce>
<ce>      He then turns to you and says, "Keep silence and half the money
<ce>            will be yours. He can do nothing to stop us."

Message:  1026
<ce>                      _noble_ throws a tantrum.
<ce>       "This is an outrage! All parties agreed, and you of all
<ce>              people should know how fragile a life is,
<ce>                  how easily it can be snuffed out!
<ce>           Necromancer, stick to your word! You do not want
<ce>      to cross a noble of ____palace_, I swear by %god's spine!"
<ce>
<ce>      The necromancer crosses his arms stiffly and pretends not
<ce>    to hear _noble_'s threats. Eventually, the noble looks to you,
<ce>     waiting to see what you will decide. Will you support _noble_
<ce>        and accept the fame he originally promised you (yes),
<ce>       or side with the necromancer for 5,000 gold (no)?

Message:  1027
<ce>          As attractive as money is, you refuse to turn your
<ce>             back on _noble_. You tackle the necromancer,
<ce>          and a brawl ensues while the noble calls for help.
<ce>        Before the magician can get away, an entire platoon of
<ce>  bodyguards fills the palace, casting silence and paralysis spells
<ce>  prior to hauling him away. You doubt he has many more hours to live.
<ce>
<ce>                 _noble_ clutches his chest and says,
<ce>         "You have proven yourself an ally unlike any other.
<ce>      Not even a pile of gold could make you withdraw your word.
<ce>      I will spin this necromancer's arrival into some entirely
<ce>           different story, and you will be the hero of it.
<ce>                     I swear by %god's life that
<ce>             you will be an idol throughout ___palace_.
<ce>             My sincerest thanks to you, %pcf. Farewell."

QBN:
Item _letter_ letter used 1012
Item _reward_ gold range 5000 to 5000

Person _noble_ group Noble male
Person _necromancer_ faction The_Necromancers male

Place _town_ remote city
Place _dung_ remote dungeon
Place _palace_ remote palace

Foe _zomb_ is Zombie
Foe _skel_ is Skeletal_warrior
Foe _sold_ is Knight

Clock _timer_ 0:00 0 flag 1 range 0 1
Clock _delay_ 0:05

--	Quest start-up:
    give pc _letter_ notify 1011
    have _letter_ set _begin_

_begin_ task:
    start timer _timer_
    place npc _noble_ at _palace_
    pc at _palace_ do _inside_

variable _inside_

_clicknoble_ task:
    clicked npc _noble_
    take _letter_ from pc
    prompt 1013 yes _accept_ no _refuse_
    stop timer _timer_

_refuse_ task:
    say 1016
    start task _revenge_
    remove log step 0

variable _revenge_

_killrevenge_ task:
    when _revenge_ and not _inside_
    say 1017
    setplayercrime Criminal_Conspiracy
    spawncityguards immediate
    start timer _delay_

_delay_ task:
    end quest

_accept_ task:
    say 1014
    place npc _necromancer_ at _dung_
    log 1015 step 0
    reveal _dung_

_clickednec_ task:
    clicked npc _necromancer_
    say 1018
    clear _clicknoble_
    log 1019 step 1

_clickboth_ task:
    when _clicknoble_ and _clickednec_
    say 1020
    log 1021 step 1
    pc at _town_ do _attown_

variable _attown_

_notnight_ task:
    daily from 5:00 to 19:00

_noattack_ task:
    when _notnight_ and _attown_
    say 1022

_attacktime_ task:
    when _attown_ and not _notnight_ and not _slain_
    say 1023
    create foe _skel_ every 1 minutes indefinitely with 30% success
    create foe _zomb_ every 1 minutes indefinitely with 25% success
    create foe _sold_ every 1 minutes indefinitely with 100% success
    create foe _sold_ every 0 minutes 3 times with 100% success
    create foe _skel_ every 1 minutes 1 times with 100% success

_infight_ task:
    daily from 0:00 to 23:59
    change foe _skel_ infighting true
    change foe _zomb_ infighting true
    change foe _sold_ infighting true
    change foe _sold_ team 1
    clear _infight_

_slainzomb_ task:
    killed 8 _zomb_
    start task _slain_

_slainskel_ task:
    killed 10 _skel_
    start task _slain_

_slain_ task:
    say 1024
    clear _clicknoble_
    remove foe _skel_
    remove foe _zomb_
    remove foe _sold_

_finaltalk_ task:
    when _clicknoble_ and _slain_
    say 1025
    prompt 1026 yes _nobleend_ no _necroend_

_nobleend_ task:
    say 1027
    legal repute +60
    hide npc _noble_
    end quest

_necroend_ task:
    give pc _reward_
    start task _revenge_
    hide npc _noble_

_timer_ task:
    end quest