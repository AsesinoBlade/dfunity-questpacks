Quest: JHFG037
DisplayName: Marching Atronachs
-- Message panels
QRC:

QuestorOffer:  [1000]
<ce>          Some idiot mage has been hiding somewhere in town,
<ce>        creating atronachs that hurt people. The %t is making
<ce>        a big fuss to find the misanthrope, but it isn't easy.
<ce>        There's a contract paying good gold if you're willing
<ce>              to head out into the streets and smash any
<ce>                 of the atronachs you see out there.

RefuseQuest:  [1001]
<ce>       Well, if you're headed out into the streets, stay safe.
<ce>                Hopefully they catch this moron soon.

AcceptQuest:  [1002]
<ce>                Great! I knew we'd find someone soon.
<ce>            Just step outside. Explore the town, go around
<ce>         the streets. As long as you're outside, they should
<ce>              make themselves known one way or another.
<ce>                 And if you kill them, maybe they'll
<ce>     figure you for a threat and stop attacking the townspeople.
<ce>          Best case scenario, right? Anyway, enough from me.
<ce>    Destroy them until they stop appearing, that's all I can say.
<ce>     I don't know how long it's gonna take, but you've got 7 days
<ce>     to clear the streets of them. That's plenty of time, I say.
<ce>             I'll pay you =reward_ gold when you're back.

QuestFail:  [1003]
<ce>          Seven days are up, and you let too many atronachs
<ce>         slip through ___questgiver_. Your reward is forfeit.

QuestComplete:  [1004]
<ce>          Good news, %pcf. They caught the imbecile who was
<ce>     creating the atronachs. That's why they stopped showing up.
<ce>             Have your gold with ___questgiver_'s thanks.

Message:  1030
%qdt:
 It seems all-out war has broken
 out between the forces of
 %crn and some renegade
 group of knight pretenders
 called the Knights of the _gem_
 in the city of ___palace_.
 I must defend the town as well
 as I can for my own part.

Message:  1031
%qdt:
 The guards have told me to hurry
 to the _palace_ in ___palace_,
 as it appears the invaders
 have entered it.

Message:  1099
<ce>                      Protect ___palace_, %pcf!
<ce>                       They are nearly upon us!

QBN:
Item _gem_ gem

Person _questgiver_ group Questor male

Place _palace_ local palace

Clock _timer_ 02:00
Clock _delay_ 00:01
Clock _delay2_ 00:02
Clock _delay3_ 00:01
Clock _outdoors_ 00:18

Foe _warr_ is Warrior
Foe _barb_ is Knight
Foe _kni_ is 2 Barbarian
Foe _spells_ is Spellsword

--changed warrior and barbarian around since outdoor spawns need to be on the same team

--	Quest start-up:
    start timer _timer_
    start timer _delay_
    log 1030 step 0
    pc at _palace_ set _inside_
    pc at any fighters set _fightered_
    pc at any tavern set _taverned_
    pc at any house set _homed_
    pc at any shop set _shopped_
    pc at any magery set _maged_
    pc at any temple set _templed_

variable _fightered_
variable _taverned_
variable _homed_
variable _shopped_
variable _maged_
variable _templed_

_day_ task:
    daily from 00:00 to 23:59
    change foe _warr_ infighting true
    change foe _barb_ infighting true
    change foe _kni_ infighting true
    change foe _spells_ infighting true
    change foe _spells_ team 1
    clear _day_

_delay_ task:
    say 1010
    start timer _delay2_

variable _delay2_

_spawnout_ task:
    when _delay2_ and not _slain_ and not _taverned_ and not _fightered_ and not _homed_ and not _shopped_ and not _maged_ and not _templed_
    start timer _outdoors_
    create foe _warr_ every 1 minutes indefinitely with 50% success
    create foe _barb_ every 1 minutes indefinitely with 50% success
    create foe _spells_ every 1 minutes indefinitely with 65% success msg 1012

_msg_ task:
    killed 1 _warr_
    killed 1 _barb_
    say 1011

variable _outdoors_
_slain_ task:
    killed 8 _warr_
    killed 7 _barb_

_finish1_ task:
    when _outdoors_ and _slain_
    say 1020
    log 1031 step 1

variable _inside_
_spawnin_ task:
    when _inside_ and _finish1_
    create foe _kni_ every 0 minutes 1 times with 100% success
    create foe _kni_ every 3 minutes 1 times with 100% success
    create foe _kni_ every 6 minutes 1 times with 100% success

_victory_ task:
    killed 6 _kni_
    start timer _delay3_

_delay3_ task:
    give pc nothing
    legal repute +6
    end quest

_qgclicked_ task:
    clicked npc _questgiver_

_timer_ task:
    say 1024
    end quest

_clearclick_ task:
    when _qgclicked_ and not _slain_
    say 1099
    clear _qgclicked_ _clearclick_
